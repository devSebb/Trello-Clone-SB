import e from"dragula";var t="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var n=e;(function(){(this||t).jKanban=function(){var e=this||t;var a={enabled:false};var o={enabled:false};(this||t)._disallowedItemProperties=["id","title","click","drag","dragend","drop","order"];(this||t).element="";(this||t).container="";(this||t).boardContainer=[];(this||t).handlers=[];(this||t).dragula=n;(this||t).drake="";(this||t).drakeBoard="";(this||t).itemAddOptions=o;(this||t).itemHandleOptions=a;var i={element:"",gutter:"15px",widthBoard:"250px",responsive:"700",responsivePercentage:false,boards:[],dragBoards:true,dragItems:true,itemAddOptions:o,itemHandleOptions:a,dragEl:function(e,t){},dragendEl:function(e){},dropEl:function(e,t,n,a){},dragBoard:function(e,t){},dragendBoard:function(e){},dropBoard:function(e,t,n,a){},click:function(e){},buttonClick:function(e,t){}};arguments[0]&&"object"===typeof arguments[0]&&((this||t).options=__extendDefaults(i,arguments[0]));(this||t).__getCanMove=function(t){return e.options.itemHandleOptions.enabled?e.options.itemHandleOptions.handleClass?t.classList.contains(e.options.itemHandleOptions.handleClass):t.classList.contains("item_handle"):!!e.options.dragItems};(this||t).init=function(){__setBoard();if(window.innerWidth>e.options.responsive){e.drakeBoard=e.dragula([e.container],{moves:function(t,n,a,o){return!!e.options.dragBoards&&(a.classList.contains("kanban-board-header")||a.classList.contains("kanban-title-board"))},accepts:function(e,t,n,a){return t.classList.contains("kanban-container")},revertOnSpill:true,direction:"horizontal"}).on("drag",(function(t,n){t.classList.add("is-moving");e.options.dragBoard(t,n);"function"===typeof t.dragfn&&t.dragfn(t,n)})).on("dragend",(function(t){__updateBoardsOrder();t.classList.remove("is-moving");e.options.dragendBoard(t);"function"===typeof t.dragendfn&&t.dragendfn(t)})).on("drop",(function(t,n,a,o){t.classList.remove("is-moving");e.options.dropBoard(t,n,a,o);"function"===typeof t.dropfn&&t.dropfn(t,n,a,o)}));e.drake=e.dragula(e.boardContainer,{moves:function(t,n,a,o){return e.__getCanMove(a)},revertOnSpill:true}).on("cancel",(function(t,n,a){e.enableAllBoards()})).on("drag",(function(t,n){var a=t.getAttribute("class");if(""!==a&&a.indexOf("not-draggable")>-1)e.drake.cancel(true);else{t.classList.add("is-moving");e.options.dragEl(t,n);var o=__findBoardJSON(n.parentNode.dataset.id);void 0!==o.dragTo&&e.options.boards.map((function(t){-1===o.dragTo.indexOf(t.id)&&t.id!==n.parentNode.dataset.id&&e.findBoard(t.id).classList.add("disabled-board")}));null!==t&&"function"===typeof t.dragfn&&t.dragfn(t,n)}})).on("dragend",(function(t){e.options.dragendEl(t);null!==t&&"function"===typeof t.dragendfn&&t.dragendfn(t)})).on("drop",(function(t,n,a,o){e.enableAllBoards();var i=__findBoardJSON(a.parentNode.dataset.id);void 0!==i.dragTo&&-1===i.dragTo.indexOf(n.parentNode.dataset.id)&&n.parentNode.dataset.id!==a.parentNode.dataset.id&&e.drake.cancel(true);if(null!==t){var d=e.options.dropEl(t,n,a,o);false===d&&e.drake.cancel(true);t.classList.remove("is-moving");"function"===typeof t.dropfn&&t.dropfn(t,n,a,o)}}))}};(this||t).enableAllBoards=function(){var e=document.querySelectorAll(".kanban-board");if(e.length>0&&void 0!==e)for(var t=0;t<e.length;t++)e[t].classList.remove("disabled-board")};(this||t).addElement=function(t,n){var a=e.element.querySelector('[data-id="'+t+'"] .kanban-drag');var o=document.createElement("div");o.classList.add("kanban-item");"undefined"!==typeof n.id&&""!==n.id&&o.setAttribute("data-eid",n.id);n.class&&Array.isArray(n.class)&&n.class.forEach((function(e){o.classList.add(e)}));o.innerHTML=__buildItemTitle(n.title);o.clickfn=n.click;o.dragfn=n.drag;o.dragendfn=n.dragend;o.dropfn=n.drop;__appendCustomProperties(o,n);__onclickHandler(o);e.options.itemHandleOptions.enabled&&(o.style.cursor="default");a.appendChild(o);return e};(this||t).addForm=function(t,n){var a=e.element.querySelector('[data-id="'+t+'"] .kanban-drag');var o=n.getAttribute("class");n.setAttribute("class",o+" not-draggable");a.appendChild(n);return e};(this||t).addBoards=function(t,n){if(e.options.responsivePercentage){e.container.style.width="100%";e.options.gutter="1%";if(window.innerWidth>e.options.responsive)var a=(100-2*t.length)/t.length;else a=100-2*t.length}else a=e.options.widthBoard;var o=e.options.itemAddOptions.enabled;var i=e.options.itemAddOptions.content;var d=e.options.itemAddOptions.class;var r=e.options.itemAddOptions.footer;for(var s in t){var l=t[s];n||e.options.boards.push(l);e.options.responsivePercentage||(""===e.container.style.width?e.container.style.width=parseInt(a)+2*parseInt(e.options.gutter)+"px":e.container.style.width=parseInt(e.container.style.width)+parseInt(a)+2*parseInt(e.options.gutter)+"px");var c=document.createElement("div");c.dataset.id=l.id;c.dataset.order=e.container.childNodes.length+1;c.classList.add("kanban-board");e.options.responsivePercentage?c.style.width=a+"%":c.style.width=a;c.style.marginLeft=e.options.gutter;c.style.marginRight=e.options.gutter;var p=document.createElement("header");if(""!==l.class&&void 0!==l.class)var u=l.class.split(",");else u=[];p.classList.add("kanban-board-header");u.map((function(e){e=e.replace(/^[ ]+/g,"");p.classList.add(e)}));p.innerHTML='<div class="kanban-title-board">'+l.title+"</div>";var f=document.createElement("main");f.classList.add("kanban-drag");if(""!==l.bodyClass&&void 0!==l.bodyClass)var m=l.bodyClass.split(",");else m=[];m.map((function(e){f.classList.add(e)}));e.boardContainer.push(f);for(var v in l.item){var h=l.item[v];var g=document.createElement("div");g.classList.add("kanban-item");h.id&&(g.dataset.eid=h.id);h.class&&Array.isArray(h.class)&&h.class.forEach((function(e){g.classList.add(e)}));g.innerHTML=__buildItemTitle(h.title);g.clickfn=h.click;g.dragfn=h.drag;g.dragendfn=h.dragend;g.dropfn=h.drop;__appendCustomProperties(g,h);__onclickHandler(g);e.options.itemHandleOptions.enabled&&(g.style.cursor="default");f.appendChild(g)}var b=document.createElement("footer");if(o){var _=document.createElement("BUTTON");var y=document.createTextNode(i||"+");_.setAttribute("class",d||"kanban-title-button btn btn-default btn-xs");_.appendChild(y);r?b.appendChild(_):p.appendChild(_);__onButtonClickHandler(_,l.id)}c.appendChild(p);c.appendChild(f);c.appendChild(b);e.container.appendChild(c)}return e};(this||t).findBoard=function(t){var n=e.element.querySelector('[data-id="'+t+'"]');return n};(this||t).getParentBoardID=function(t){"string"===typeof t&&(t=e.element.querySelector('[data-eid="'+t+'"]'));return null===t?null:t.parentNode.parentNode.dataset.id};(this||t).moveElement=function(e,t,n){if(e!==this.getParentBoardID(t)){this.removeElement(t);return this.addElement(e,n)}};(this||t).replaceElement=function(t,n){var a=t;"string"===typeof a&&(a=e.element.querySelector('[data-eid="'+t+'"]'));a.innerHTML=n.title;a.clickfn=n.click;a.dragfn=n.drag;a.dragendfn=n.dragend;a.dropfn=n.drop;__appendCustomProperties(a,n);return e};(this||t).findElement=function(t){var n=e.element.querySelector('[data-eid="'+t+'"]');return n};(this||t).getBoardElements=function(t){var n=e.element.querySelector('[data-id="'+t+'"] .kanban-drag');return n.childNodes};(this||t).removeElement=function(t){"string"===typeof t&&(t=e.element.querySelector('[data-eid="'+t+'"]'));null!==t&&("function"==typeof t.remove?t.remove():t.parentNode.removeChild(t));return e};(this||t).removeBoard=function(t){var n=null;"string"===typeof t&&(n=e.element.querySelector('[data-id="'+t+'"]'));null!==n&&("function"==typeof n.remove?n.remove():n.parentNode.removeChild(n));for(var a=0;a<e.options.boards.length;a++)if(e.options.boards[a].id===t){e.options.boards.splice(a,1);break}return e};(this||t).onButtonClick=function(e){};function __extendDefaults(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function __setBoard(){e.element=document.querySelector(e.options.element);var n=document.createElement("div");n.classList.add("kanban-container");e.container=n;if(document.querySelector(e.options.element).dataset.hasOwnProperty("board")){t.url=document.querySelector(e.options.element).dataset.board;window.fetch(url,{method:"GET",headers:{"Content-Type":"application/json"}}).then((t=>{t.json().then((function(t){e.options.boards=t;e.addBoards(e.options.boards,true)}))})).catch((e=>{console.log("Error: ",e)}))}else e.addBoards(e.options.boards,true);e.element.appendChild(e.container)}function __onclickHandler(n,a){n.addEventListener("click",(function(n){n.preventDefault();e.options.click(this||t);"function"===typeof(this||t).clickfn&&this.clickfn(this||t)}))}function __onButtonClickHandler(n,a){n.addEventListener("click",(function(n){n.preventDefault();e.options.buttonClick(this||t,a)}))}function __findBoardJSON(t){var n=[];e.options.boards.map((function(e){if(e.id===t)return n.push(e)}));return n[0]}function __appendCustomProperties(t,n){for(var a in n)e._disallowedItemProperties.indexOf(a)>-1||t.setAttribute("data-"+a,n[a])}function __updateBoardsOrder(){var t=1;for(var n=0;n<e.container.childNodes.length;n++)e.container.childNodes[n].dataset.order=t++}function __buildItemTitle(t){var n=t;if(e.options.itemHandleOptions.enabled)if(void 0===(e.options.itemHandleOptions.customHandler||void 0)){var a=e.options.itemHandleOptions.customCssHandler;var o=e.options.itemHandleOptions.customCssIconHandler;void 0===(a||void 0)&&(a="drag_handler");void 0===(o||void 0)&&(o=a+"_icon");n="<div class='item_handle "+a+"'><i class='item_handle "+o+"'></i></div><div>"+n+"</div>"}else n=e.options.itemHandleOptions.customHandler.replace("%s",n);return n}this.init()}})();var a={};export default a;

